<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.unlimited.sports.globox.merchant.mapper.MerchantVenueBookingSlotTemplateMapper">

    <!-- 根据场地ID查询所有模板（按时间排序） -->
    <select id="selectByCourtIdOrderByTime" resultType="com.unlimited.sports.globox.model.merchant.entity.VenueBookingSlotTemplate">
        SELECT * FROM venue_booking_slot_template
        WHERE court_id = #{courtId}
        ORDER BY start_time ASC
    </select>

    <!-- 批量插入模板 -->
    <insert id="batchInsert" useGeneratedKeys="true" keyProperty="bookingSlotTemplateId">
        INSERT INTO venue_booking_slot_template (court_id, start_time, end_time)
        VALUES
        <foreach collection="templates" item="item" separator=",">
            (#{item.courtId}, #{item.startTime}, #{item.endTime})
        </foreach>
    </insert>

    <!-- 删除场地的所有模板 -->
    <update id="deleteByCourtId">
        UPDATE venue_booking_slot_template
        SET is_deleted = 1, updated_at = NOW()
        WHERE court_id = #{courtId} AND is_deleted = 0
    </update>

    <select id="MerchantSelectByCourtIdsAndTimeRange" resultType="com.unlimited.sports.globox.model.merchant.entity.VenueBookingSlotTemplate">
        SELECT
        booking_slot_template_id AS bookingSlotTemplateId,
        court_id AS courtId,
        start_time AS startTime,
        end_time AS endTime,
        created_at AS createdAt,
        updated_at AS updatedAt
        FROM venue_booking_slot_template
        WHERE court_id IN
        <foreach collection="courtIds" item="courtId" open="(" separator="," close=")">
            #{courtId}
        </foreach>
        <!-- 槽位开始时间 >= 营业开始时间 且 槽位结束时间 <= 营业结束时间 -->
        AND start_time &gt;= #{openTime}
        AND end_time &lt;= #{closeTime}
        ORDER BY court_id ASC, start_time ASC
    </select>

</mapper>