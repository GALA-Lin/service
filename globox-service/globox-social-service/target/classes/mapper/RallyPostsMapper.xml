<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.unlimited.sports.globox.social.mapper.RallyPostsMapper">
    <resultMap id="BaseResultMap" type="com.unlimited.sports.globox.model.social.entity.RallyPosts">
        <id column="rally_post_id" jdbcType="BIGINT" property="rallyPostId" />
        <id column="initiator_id" jdbcType="BIGINT" property="initiatorId" />
        <id column="rally_title" jdbcType="VARCHAR" property="rallyTitle" />
        <id column="rally_region" jdbcType="VARCHAR" property="rallyRegion" />
        <id column="venue_name" jdbcType="VARCHAR" property="rallyVenueName" />
        <id column="court_name" jdbcType="VARCHAR" property="rallyCourtName" />
        <id column="event_date" jdbcType="DATE" property="rallyEventDate" />
        <id column="time_type" jdbcType="TINYINT" property="rallyTimeType" />
        <id column="time_start" jdbcType="TIME" property="rallyStartTime" />
        <id column="time_end" jdbcType="TIME" property="rallyEndTime" />
        <id column="cost" jdbcType="DECIMAL" property="rallyCost" />
        <id column="cost_bearer" jdbcType="TINYINT" property="rallyCostBearer" />
        <id column="activity_type" jdbcType="TINYINT" property="rallyActivityType" />
        <id column="gender_limit" jdbcType="TINYINT" property="rallyGenderLimit" />
        <id column="ntrp_min" jdbcType="DECIMAL" property="rallyNtrpMin" />
        <id column="ntrp_max" jdbcType="DECIMAL" property="rallyNtrpMax" />
        <id column="total_people" jdbcType="BIGINT" property="rallyTotalPeople" />
        <id column="remaining_people" jdbcType="BIGINT" property="rallyRemainingPeople" />
        <id column="notes" jdbcType="VARCHAR" property="rallyNotes" />
        <id column="status" jdbcType="TINYINT" property="rallyStatus" />
        <id column="created_at" jdbcType="TIMESTAMP" property="rallyCreatedAt" />
        <id column="updated_at" jdbcType="TIMESTAMP" property="rallyUpdatedAt" />

    </resultMap>
<!--    TODO ETA 2026.1.5 使用mp重构sql-->
    <select id="getRallyPostsList" resultMap="BaseResultMap">
        select
        rally_post_id,
        initiator_id,
        rally_title,
        rally_region,
        venue_name,
        court_name,
        event_date,
        time_type,
        time_start,
        time_end,
        cost,
        cost_bearer,
        activity_type,
        gender_limit,
        ntrp_min,
        ntrp_max,
        total_people,
        remaining_people,
        notes,
        status,
        created_at,
        updated_at
        from rally_posts
        where 1=1
        <if test="rallyQueryDto.area != null and rallyQueryDto.area != ''">
            and rally_region like concat('%', #{rallyQueryDto.area}, '%')
        </if>
        <if test="rallyQueryDto.timeRange != null and rallyQueryDto.timeRange != ''">
            and time_start >= #{rallyQueryDto.timeRangeStart}
            and time_start &lt;= #{rallyQueryDto.timeRangeEnd}
        </if>
        <if test="rallyQueryDto.genderLimit != null">
            and gender_limit = #{rallyQueryDto.genderLimit}
        </if>
        <if test="rallyQueryDto.ntrpMin != null">
            and ntrp_min >= #{rallyQueryDto.ntrpMin}
        </if>
        <if test="rallyQueryDto.ntrpMax != null">
            and ntrp_max &lt;= #{rallyQueryDto.ntrpMax}
        </if>
        <if test="rallyQueryDto.activityType != null">
            and activity_type = #{rallyQueryDto.activityType}
        </if>
        limit #{offset}, #{pageSize}
    </select>
    <select id="selectByPostId" resultMap="BaseResultMap">
        select
            rally_post_id,
            initiator_id,
            rally_title,
            rally_region,
            venue_name,
            court_name,
            event_date,
            time_type,
            time_start,
            time_end,
            cost,
            cost_bearer,
            activity_type,
            gender_limit,
            ntrp_min,
            ntrp_max,
            total_people,
            remaining_people,
            notes,
            status,
            created_at,
            updated_at
        from rally_posts
        where rally_post_id = #{rallyPostId}
    </select>
    <select id="myActivities" resultMap="BaseResultMap">
        select
            rally_post_id,
            initiator_id,
            rally_title,
            rally_region,
            venue_name,
            court_name,
            event_date,
            time_type,
            time_start,
            time_end,
            cost,
            cost_bearer,
            activity_type,
            gender_limit,
            ntrp_min,
            ntrp_max,
            total_people,
            remaining_people,
            notes,
            status,
            created_at,
            updated_at
        from rally_posts
        where initiator_id = #{userId}
        limit #{offset}, #{pageSize}
    </select>
</mapper>